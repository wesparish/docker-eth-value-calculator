<!doctype html>
<head>
  <title>Ethereum Value Calculator</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" 
        crossorigin="anonymous">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="{{url_for('static', filename='jquery.js') }}">\x3C/script>')</script>

  <script type=text/javascript>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  </script>

  <style>
    div.top-buffer {
      margin-top:40px;
    }
    button.submit-button {
      margin-top:40px;
      background: #ccc url('https://media.tenor.com/images/903f9887941e6799b9da9f3dc6c82891/tenor.gif') no-repeat top left;
      padding-left: 50px;
      background-size: contain;
    }
  </style>

</head>

<body id="page-top">

  <script type="text/javascript">
    $(function() {
      var submit_form = function(e) {
        $.getJSON($SCRIPT_ROOT + '/get-all-transactions/' + address, {
          address: $('input[id="address"]').val()
        }, function(data) {
          $('#result').text(data.result);
        });
        return false;
      };
      $('#submit-button').bind('click', submit_form);
      $('input[type=text]').bind('keydown', function(e) {
        if (e.keyCode == 13) {
          submit_form(e);
        }
      });
      $('input[id=address]').focus();
    });
  </script>

  <script>
$(function() {
    $('#submit-button').on('click', function (e) {
        e.preventDefault(); // disable the default form submit event

        var $form = $('#eth-form');
        var $url = $form.attr("action") + "/" + $("#address").val();

        console.log("url: " + $url)

        $("#result").html('<img class="img-responsive center-block" src="https://media.tenor.com/images/903f9887941e6799b9da9f3dc6c82891/tenor.gif" />')

        $.ajax({
            url: $url,
            type: $form.attr("method"),
            data: $form.serialize(),
            success: function (response) {
                console.log("response: " + JSON.stringify(response))

                $(function() {
                    var $tableStr = '<table id="result-table" class="table table-striped"><tr><th scope="col">Block Number</th><th scope="col">Address</th><th scope="col">Timestamp</th><th scope="col">Date</th><th scope="col">Value ETH</th><th scope="col">Value USD</th></tr></table>';
                    $("#result").html($tableStr);
                    $.each(response, function(i, item) {
                        var $tr = $('<tr>').append(
                            $('<td>').text(item.block_number),
                            $('<td>').text(item.address),
                            $('<td>').text(item.timestamp),
                            $('<td>').text(new Date(item.timestamp*1000)),
                            $('<td>').text(item.value_eth),
                            $('<td>').text(item.value_usd)
                        ).appendTo('#result-table');
                    });
                });
            },
            error: function (response) {
                $("#result").text('Unable to contact server')
            },
        });
    });
});
  </script>

  <div class="container">
    <div class="row" id="header">
      <div class="col-xs-12 text-center">
        <h2 class="section-heading">Ethereum Value Calculator</h2>
        <p>Compute mined Ethereum value (at time of mining) from Nanopool and Ethermine</p>
      </div>
    </div>

    <div class="row top-buffer">
      <div class="col-xs-4"/></div>
      <div class="col-xs-4">
        <form id="eth-form" method="get" action="/get-all-transactions">
          <div class="form-group">
            <label for="address">Ethereum Address</label>
            <input type="text" id="address" class="form-control" placeholder="0x12345..." value="0x559db2865e1f099d63037c3ae4a6c8cc1106c819" required autofocus>
          </div>
          <div class="form-group">
            <button class="btn btn-lg btn-primary btn-block" type="submit" id="submit-button">Get Results</button>
            <!-- <input type="button" value="Get Results" onclick="submit_form" class="btn btn-lg btn-primary btn-block" /> -->
          </div>
        </form>
      </div>
      <div class="col-xs-4">
      </div>
    </div>

    <div class="row top-buffer">
      <div class="col-xs-12">
        <div id="result"></div>
      </div>
    </div>

  </div>
</body>
